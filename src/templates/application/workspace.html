{% load static %}

<!DOCTYPE html>
<html>
<head>

<title>LGIR: {% block includes %}{{ appcode }}{% endblock includes %} Workspace</title>

<!-- Including the blockly application from the static files directory -->
<script src="{% static 'application/blockly/google-blockly-edd475f/blockly_compressed.js' %}"></script>
<script src="{% static 'application/blockly/google-blockly-edd475f/blocks_compressed.js' %}"></script>
<script src="{% static 'application/blockly/google-blockly-edd475f/javascript_compressed.js' %}"></script>
<script src="{% static 'application/blockly/google-blockly-edd475f/python_compressed.js' %}"></script>
<script src="{% static 'application/blockly/google-blockly-edd475f/msg/js/en.js' %}"></script>

<link rel="icon" href="{% static 'images/favicon.png' %}" sizes="16x16" type="image/png">

<!-- Loading Static CSS -->
<link rel="stylesheet" href="{% static 'css/generics/main.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'css/application/chat.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'css/application/navigation.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'css/application/workspace.css' %}" type="text/css">

</head>

<body>
<!-- Defining the page navigation bars -->
<ul id="top_nav">
  <li><a id="site-title">LGIR</a></li>
  <li><a href="./../../../dashboard/">Dashboard</a></li>
  <li><a>Account Settings</a></li>
  <li style="float:right"><a>Logout</a></li>
</ul>

<ul id="mobile-top-nav">
  <li><a>&#9776</a></li>
  <li><a>LGIR</a></li>
</ul>

<ul id="project_nav">
  <li><a>{{ appcode }}</a></li>
  <li><a id="toggle-monitor">Monitor</a></li>
  <li><a id="request-edit">Edit</a>
  <li><a id="download-code">Download Code</a></li>
  <li><a id="toggle-chat">Chat</a></li>
  <li><a>Project Settings</a></li>
</ul>

<!-- Defining the main container for the page -->
<div id="main">

  <!-- Holds all items relating to Blockly -->
  <div id="workspace-area">
    <div id="blockly-wrapper">
      <div id="workspace-loading-message">
        <h1>Loading the workspace</h1>
      </div>

      <div id="allow-edit-message" style="display: none">
        <h1>Someone would like to edit the workspace.</h1>
        <h2>Make them the editor?<h2>
        <a id='allow-edit'>Yes</a>
        <a id='block-edit'>No</a>
        <h3>You'll give automatic permission in 5 seconds</h3>
      </div>

      <div id="someone-is-editing-message" style="display: none">
        <h1>Someone is editing the workspace right now.</h1>
        <h2>Press the edit button to ask for edit permissions.</h2>
      </div>

      <div id="positive-edit-message" style="display: none">
        <h1>You now have permission to edit the workspace.</h1>
      </div>

      <div id="negative-edit-message" style="display: none">
        <h1>Well this is awkward!</h1>
        <h2>The editor refused your request to edit.</h2>
      </div>

      <div id="asking-for-edit-message" style="display: none">
        <h1>You've asked for permission to edit.</h1>
        <h2>Hang on while we just ask the current editor.</h2>
      </div>

      <div id="current-editor-message" style="display: none">
        <h1>What a silly billy!</h1>
        <h2>You're already the editor.</h2>
      </div>
    </div>
    
    <div id="blockly-container" style="flex: 1;"></div>
    <div id="monitor-container" style="flex: 1;"></div>
  </div>

  <!-- Holds all items relating to chat messages -->
  <div id="chat-container">
    <div id="chat-header">{{appcode}} chat</div>
    <div id="chat-display-container"></div>
    <div id="chat-input-container"><input id="chat-input" placeholder="Please input your text here"></div>
  </div>
</div>

<!-- Creating a DIV required by Blockly to enbale the window to be resized -->
<div id="blockly-div" style="position: absolute;"></div>

<!-- Defining the Blockly Toolbox -->
<xml id="toolbox" style="display: none">
    <block type="controls_if"></block>
    <block type="controls_repeat_ext"></block>
    <block type="logic_compare"></block>
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="text"></block>
    <block type="text_print"></block>
</xml>

<!-- Creating chat -->
<script src="{% static 'application/workspace/chat.js' %}"></script>

<!-- Setting websocket routing -->
<script src="{% static 'application/workspace/socket.js' %}"></script>

<!-- Defining resize functions -->
<script src="{% static 'application/workspace/resize.js' %}"></script>

<!-- Injecting Blockly-->
<script src="{% static 'application/workspace/blockly_inject.js' %}"></script>

<script>
    //Waiting for the download code button to be clicked
    document.getElementById("download-code").addEventListener("click",function(){
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;

    //Creating a virtual download button to be clicked to house download information
    var virDownloadButton = document.createElement("a")

    //The document structure contains the type of data to be downloaded, as well as the content
    var documentStructure = "data:text/plain; charset=utf8,"
    documentStructure += encodeURIComponent(Blockly.Python.workspaceToCode(workspace))

    //Setting the href tag to download the contents of the document along with the given file name
    virDownloadButton.setAttribute("href",documentStructure)
    virDownloadButton.setAttribute("download","{{appcode}} Python Code.py")

    //Append the virtual button to the main tag
    var main = document.getElementById("main")
    document.body.appendChild(virDownloadButton)
    virDownloadButton.click()
    document.body.removeChild(virDownloadButton)

  })

  
</script>

<!-- <script>
  // Definition Block
var pin = 0;
var pos = 1;
Blockly.Blocks['Pin_Value'] = {
  innit: function() {
    this.appendValueInput('VALUE')
        .setCheck('Number')
        .appendField('value is ');
    this.setOutput(true, 'PIN: ', pin, 'AT', pos);
    this.setColour(160);
    this.setPreviousStatement(true); 
    this.setNextStatement(true); 
  }
};
// Block input types - value, statement or dummy.

  // Generator Stub
Blockly.Javascript['Pin_Value'] = function(block){
  var code = '...;\n';
  return code;
}
</script> -->

</body>
</html>
